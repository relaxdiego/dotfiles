#!/bin/bash -e

ensure_host_key() {
    if ! grep "$1" ~/.ssh/known_hosts; then
        echo "$1" >> ~/.ssh/known_hosts
    fi
}

mkdir -p ~/.ssh
touch ~/.ssh/known_hosts

# Github host keys (ECDSA SHA256:p2QAMXNIC1TJYWeIOttrVc98/R1BUFWu3/LiyKgUfQM)
ensure_host_key "github.com,20.205.243.166 ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBEmKSENjQEezOmxkZMy7opKgwFB9nkt5YRrYMjNuG5N87uRgg6CLrbo5wAdT/y6v0mKV0U2w0WZ2YB/++Tpockg="

{{ if eq .chezmoi.os "linux" -}}
    {{ if eq .chezmoi.osRelease.id "ubuntu" -}}
    # Re-hash the known_hosts file
    ssh-keygen -Hf ~/.ssh/known_hosts
    rm -f ~/.ssh/known_hosts.old
    {{ end -}}
{{ end -}}
