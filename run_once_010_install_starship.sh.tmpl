#!/bin/bash -e
which starship && exit 0

{{ $starship_version := "1.0.0" -}}

{{- if eq .chezmoi.os "linux" -}}
OS_BINARY=unknown-linux-gnu
{{- else if eq .chezmoi.os "darwin" -}}
OS_BINARY=apple-darwin
{{- else -}}
echo "ERROR: Unexpected operating system '{{ .chezmoi.os }}'"
{{- end }}

cd /tmp
wget -O starship.tar.gz https://github.com/starship/starship/releases/download/v{{- $starship_version -}}/starship-x86_64-${OS_BINARY}.tar.gz
wget -O starship.tar.gz.sha256 https://github.com/starship/starship/releases/download/v{{- $starship_version -}}/starship-x86_64-${OS_BINARY}.tar.gz.sha256
test "$(sha256sum starship.tar.gz | cut -d' ' -f1)" == "$(cat starship.tar.gz.sha256)" || echo "ERROR: starship CLI checksum did not match!!!"
tar -xvf starship.tar.gz
mkdir -p $HOME/bin
mv starship $HOME/bin
